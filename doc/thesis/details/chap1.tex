
\chapter{INTRODUCTION} \label{ch:introduction}

\section{Periodic Corrugations}

Integrated optics devices such as couplers, filters, DFB and DBR
lasers contain periodic corrugations. For these devices the
propagating wavelength is of the same order as the spatial period of
the corrugation. It is therefore necessary to apply field theory to
determine characteristic modes.

\subsection{Maxwell's Equations}
The four equations can be presented in differential or integral
form. They are listed below in both forms.

\begin{equation}
\begin{array}{c c}
\nabla \times \mathbf{E} = \frac{-\partial{\mathbf{B}}}{\partial{t}} &
\qquad \oint \mathbf{E} \cdot dl = \frac{-\partial}{\partial{t}}\int
\mathbf{B} \cdot d \mathbf{S} \\
\end{array}
\label{curlE}
\end{equation}

\begin{equation}
\begin{array}{c c}
\nabla \times \mathbf{H} = \mathbf{J} + 
\frac{-\partial{\mathbf{D}}}{\partial{t}} &
\qquad \oint \mathbf{H} \cdot dl = \int \mathbf{J} \cdot d \mathbf{S}
+ \frac{\partial}{\partial{t}}\int_{area} \mathbf{D} \cdot d \mathbf{S}
\end{array}
\label{curlH}
\end{equation}

\begin{equation}
\begin{array}{c c}
\nabla \cdot \mathbf{B} = 0 &
\qquad \int \mathbf{B} \cdot d\mathbf{S} = 0 \\
\nabla \cdot \mathbf{D} = \rho &
\qquad \int \mathbf{D} \cdot d\mathbf{S} = Q_{enclosed}
\end{array}
\end{equation}

$\mathbf{E}$ and $\mathbf{H}$ are electric and magnetic field
amplitudes, whereas $\mathbf{D}$ and $\mathbf{B}$ are electric and
magnetic flux densities respectively. $\mathbf{E}$, $\mathbf{H}$,
$\mathbf{D}$ and $\mathbf{D}$ are continuous functions of space and
time with continuous derivatives.

Assuming simple linear relationship between electric vectors.

\begin{equation}
\mathbf{D} = \varepsilon \mathbf{E}
\label{Ddef}
\end{equation}

Similarly relationship between $\mathbf{H}$ and $\mathbf{B}$ is given by

\begin{equation}
\mathbf{B} = \mu \mathbf{H}
\label{magflux}
\end{equation}

The displacement vector D satisfies the equation below in the absense
of electric charges.

\begin{equation}
\mathbf{\nabla \cdot D} = 0
\label{defD0}
\end{equation}

The flow of electromagnetic power is space is described by the Poynting vector

\begin{equation}
\mathbf{S} = \mathbf{E} \times \mathbf{H}
\end{equation}

The power $\mathbf{P}$ flowing through an area A with an outward-directed normal unit vector n is given by

\begin{equation}
\mathbf{P} = \int_{\mathbf{A}} \mathbf{S} \cdot \mathbf{n}\, d{A}
\end{equation}

The time averaged poynting vector is given by

\begin{equation}
\mathbf{\bar{S}} = \frac{1}{2}[\mathbf{E} \times \mathbf{H^*}]
\end{equation}

\subsection{Wave Equation}

Substituting (\ref{magflux}) into (\ref{curlE}) and taking the curl on
both sides.

\begin{equation}
\nabla \times (\nabla \times \mathbf{E}) = 
-\mu \frac{\partial{}}{\partial{t}}(\mathbf{\nabla \times H})
\label{curlcurlE}
\end{equation}

Where $\mu$ is constant. Substituting (\ref{curlH}) and (\ref{Ddef})
into (\ref{curlcurlE}).

\begin{equation}
\nabla \times (\nabla \times \mathbf{E}) + \varepsilon \mu
\frac{\partial^2{E}}{\partial{t^2}}
\label{curlcurlE2}
\end{equation}

Equation (\ref{curlcurlE2}) holds even when $\varepsilon$ varies.

\begin{equation}
\nabla \times (\nabla \times \mathbf{E}) =
\nabla (\nabla \cdot \mathbf{E}) - \nabla^2 \mathbf{E}
\label{vident}
\end{equation}

Using relationship (\ref{vident}), we can write (\ref{curlcurlE2}) as

\begin{equation}
\nabla (\nabla \cdot \mathbf{E}) - \nabla^2 \mathbf{E} + \varepsilon \mu
\frac{\partial^2{E}}{\partial{t^2}} = 0
\label{divergradE}
\end{equation}

Using (\ref{Ddef}) and product rule (\ref{divproductrule})

\begin{equation}
\nabla \cdot \left(\frac{1}{\varepsilon}\mathbf{D}\right)=
 \left(\nabla \frac{1}{\varepsilon}\right)
\cdot D + \frac{1}{\varepsilon}(\nabla \cdot D)
\label{divproductrule}
\end{equation}

And in the absence of electric charges (\ref{defD0}), we can write equation
(\ref{divergradE}) as

\begin{equation}
\nabla^2 \mathbf{E} + \nabla \left[ \mathbf{E} \cdot \frac{\nabla \varepsilon}
{\varepsilon}\right]
 = \varepsilon \mu \frac{\partial^2 \mathbf{E}}{\partial t^2}
\label{earlywaveeq}
\end{equation}

When $\varepsilon$ is constant then

\begin{equation}
\nabla^2 \mathbf{E}
 = \varepsilon \mu \frac{\partial^2 \mathbf{E}}{\partial t^2}
\label{waveeq}
\end{equation}

The integral form of the curl equations are derived from the
differential forms by application of Stokes Theorem. This
theorem relates the curl o a vector function, A, into a line
integral of the function.

\begin{equation}
\int_{area} ( \nabla \times \mathbf{A} ) \cdot d \mathbf{S} = 
\oint_{loop} \mathbf{A} \cdot dl
\end{equation}

where $d \mathbf{S}$ and $d\mathbf{l}$ are unit vectors oriented normal
to the surface. For the divergence equations, Gauss' divergence theorem

Wave equation in terms of electric field amplitude reduced to its
homogenous form is given by

\begin{equation}
\nabla^2 \mathbf{E} - \mu \epsilon \frac{\partial^2 
  \mathbf{E}}{\partial t^2} = 0
\end{equation}

The wave equation in terms of magnetic field amplitude is 

\begin{equation}
\nabla^2 \mathbf{H} - \mu \epsilon \frac{\partial^2 
  \mathbf{H}}{\partial t^2} = 0
\end{equation}

\subsection{Floquet-Bloch Waves}
The electromagnetic waves traveling
along periodic structures is described by Floquet's theorem,

\begin{equation}
\mathbf{\Psi(x,y,z)} = e^{\gamma z} \mathbf{\Phi(x,y,z)} = 0
\label{defD0}
\end{equation}

where $\Phi$ is a $z$-periodic vector valued function and $\gamma$ is
the propagation constant (Floquet multiplier). The real part of
$\gamma$ represents the attenuation and the imaginary part the phase
shift of the fundamental mode in one period.

For the period of physical corrugation of length $d$, the time
harmonic electromagnetic field $\Psi(x,y,z)$ has the property

\begin{equation}
\mathbf{\Psi(x,y,z + d)} = e^{\gamma d} \mathbf{\Psi(x,y,z)} = 0
\label{defD1}
\end{equation}

The comtemporary approaches to find propagation constant rely on
finding the roots of the determinant with Muller's or the Newton's
method. Another approach solves they eigenvalue problem by relying on
finding the roots of a Dirichlet-to-Neumann operator and linearization
of the matrix problem.

A typical waveguide geometry is shown in Fig. \ref{gratwg}. The
wavegujide geometry consists of an infinite substrate region
($\Omega_0$), several finite stratified layers, a grating layer
sandwitched between the stratified layers, and an infinite superstrate
region ($\Omega_J$). The structure is also infinite and homogeneous in
the $y$-direction. The layers are assumed to be linear, isotropic, and
non-dispersive, therefore the magnetic permeability $\mu$ and electric
permettivity $\epsilon$ are constant scalars in each layer. A finite
conductivity of the material is accounted by letting $\epsilon$ be
complex.

\setlength{\unitlength}{0.25in}
\begin{picture}(20,10)(-2.5,0)
\put(0,0){\line(1,0){15}}
\put(0,2.5){\line(1,0){15}}
\put(0,5){\line(1,0){15}}
\put(5,-0.4){\line(0,1){5.8}}
\put(7.5,-0.4){\line(0,1){5.8}}
\put(9.5,0){\line(0,1){1.0}}
\put(9.5,2.5){\line(0,1){1.0}}
\put(10.5,2.5){\line(0,1){1.0}}
\label{gratwg}
\end{picture}

For this geometry the fundamental modes of the guide are either
transverse electric (TE), where the electric field only has component
in the $y$-direction,

\begin{equation}
\mathbf{E}(x,y,z) = u(x,z)\mathbf{e}_y
\end{equation}

or transverse magnetic (TM), where the magnetic field only has component in
the $y$-direction,

\begin{equation}
\mathbf{H}(x,y,z) = u(x,z)\mathbf{h}_y
\end{equation}

where the wavefunction $u$ satisfies the Helmholtz equation

\begin{equation}
\triangle u + \mu \epsilon \omega^2 u = 0
\end{equation}

in each layer.

Or,

\begin{equation}
\triangle u + \kappa^2 u = 0
\label{HelmholtzEq2}
\end{equation}

The wave number $\kappa$ depends on the electromagnetic properties of
the layers and is piecewise constant function

\begin{equation}
\kappa(x,z) = \kappa_j = \omega \sqrt{\mu_0 \epsilon_j}
\end{equation}

The condition, 

\begin{equation}
u^+ = u^- \textrm{and} \quad \frac{1}{\mu^+}\frac{\partial{u^+}}{\partial{n}} =
\frac{1}{\mu^-}\frac{\partial{u^-}}{\partial{n}} \quad \textrm{for TE modes},
\end{equation}

\begin{equation}
u^+ = u^- \textrm{and} \quad \frac{1}{\epsilon^+}\frac{\partial{u^+}}{\partial{n}} =
\frac{1}{\epsilon^-}\frac{\partial{u^-}}{\partial{n}} \quad \textrm{for TM modes},
\end{equation}

holds at the interface of two different layers for TE and TM modes
respectively. The superscript refers to the left or right side of the
interface. In practical applications, the optical waveguide material
is non-magnetic with magnetic permeability equal to that of free
space.

Floquet theory PDEs with periodic coefficients can be reduced to
problems posed on one periodic cell. In that cell, the solution of the
Helmholtz equation is of the form

\begin{equation}
u(x,z) = e^{\gamma z} v(x,z)
\label{solutionHelmholtz}
\end{equation}

where $v$ is periodic in z.

Substituting $u$ in (\ref{solutionHelmholtz}) into the Helmholtz
equation (\ref{HelmholtzEq2}) results in

\begin{equation}
\triangle v + 2 \gamma v_z + (\gamma^2 + \kappa^2)v = 0
\label{HelmholtzPDE}
\end{equation}

Because of periodicity, (\ref{HelmholtzPDE}) can be solved in the unit
strip $\mathbf{R} x [0,1]$ with periodic boundary conditions. The
problem is to find the characteristic values of $\gamma$ for which
equation (\ref{HelmholtzPDE}) has a non-trivial solution.

For infinite and stratified layers the solution of
(\ref{HelmholtzPDE}) is obtained by seperation of variables. In the
j-th layer the wave function is a linear superposition of spatial
harmonics in the form

\begin{equation}
v_k^{\pm j}(x,z) = e^{\pm i \gamma_k^j x} e^{2 \pi ikz}
\label{wavefun}
\end{equation}

where $\gamma_k^j$ is the transverse wave number and is given by the
dispersion relation

\begin{equation}
\gamma_k^j = \sqrt{(\gamma + 2 \pi ik)^2 + \kappa_j^2}
\label{DispRel}
\end{equation}

In each finite layer there are two fundamental modes corresponding to
the sign in (\ref{wavefun}), while there is only one mode in the semi
infinite layers. The sign is chosen such that the energy decays away
from the structure.

Inside the grating layer the wave number is a function of x and z, and
therfore the solutions can no longer be expressed in closed form and
must be determined numerically. The solution for the grating layer
must also be coupled with the analytical solution in the uniform
layers. The solution for the grating layer must be coupled with the
analytical solution in the uniform layers.

Assume that for the interior problem

\begin{equation}
\triangle v + 2 \gamma v_z + (\gamma^2 + \kappa^2)v = 0 in D_0 \\
v = f_\pm on S_\pm \\
v periodic in z
\label{HelmholtzPDEInt}
\end{equation}

is uniquely solvable. Then a pair of functions $f_\pm$ maps on the
normal derivates $\partial{v_\pm}/\partial{n}$ of the solution to
(\ref{HelmholtzPDEInt}) restricted to $S_+$ and $S_-$. For $\gamma$
fixed this is the Dirichlet-to-Neumann (D2N) operator which will be
denoted by $T_{int}(\gamma)$.

Similarly, the exterior problems

\begin{equation}
\triangle v + 2 \gamma v_z + (\gamma^2 + \kappa^2)v = 0 in D_\pm \\
v = f_\pm on S_\pm \\
v periodic in z
\label{HelmholtzPDEExt}
\end{equation}

gives rise to a D2N map which is denoted by $T_{ext}(\gamma)$. The
numerical method used to determine the characteristic values of the
full problem (\ref{HelmholtzPDE}) is based on the following:

Suppose $\gamma$ is such that the interior and exterior problems are
uniquely solvable. Then $\gamma$ is a characteristic value of
(\ref{HelmholzPDE}) if and only if $T(\gamma) \coloneqq
T_{int}(\gamma)- T_{ext}(\gamma)$ is singular.

Instead of solving (\ref{HelmholzPDE}) directly, the numerical method
is based on finding the singular vvalues of the D2N-map
$T(\gamma)$. This is a non-linear eigenvalue problem in a vector space
of functions on the interfaces $S_\pm$.

Functions on the interfaces can be expanded in terms of Fourier modes

\begin{equation}
e_k^\pm (z) = \left \{ \begin{array} {ll}
e^{(2 \pi i k z)}, \quad \textrm{on} \; S_\pm, \\
0 \quad \; \textrm{on} S_\pm, \end{array} \right .
\quad k \in \mathbf{Z}.
\label{FourierInt}
\end{equation}

In this basic the exterior D2N-map is a diagonal operator

\begin{equation}
T_{ext}(\gamma) e_k^\pm = i s_k^\pm \gamma_k^\pm e_k^\pm,
\quad k \in \mathbf{Z}.
\end{equation}

where $\gamma_k^+$ and $\gamma_k^-$ follow from the dispersion
relation (\ref{DispRel}) and $s_k^\pm$ is the sign of the solution
(\ref{wavefun}) for the infinite layer.

Since there is a non-uniform layer in the domain $D_0$, the Fourier
modes of the interior D2N-map are coupled and therefore
$T_{int}(\gamma)$ is not a diagonal operator in basis
(\ref{FourierInt}). The coefficients of $T_{int}(\gamma)$ must be
determined by first solving the interior problem (\ref{}) with
boundary condition $f_\pm = e_k^\pm$ and then calculating the Fourier
coefficients of the solution $v_k^\pm$, i.e.,

\begin{equation}
T_{int}(\gamma)_{l^\pm,k^\pm} = (e_l^\pm, \frac{\partial{v_k^\pm}
{\partial{n}}), k,l \in \mathbf{Z}
\end{equation}

In order to calculate the Floquet multipliers numerically, two
discretizations are necessary. First, only Fourier modes of order $|k|
\leq p$ are used to approximate the D2N maps. The truncation can be
regarded as Galerkin discretization of $T(\gamma)v = 0$ using the
Fourier modes up to a certain order as the trial- and test
space. Solving the interior problem numerically involves a second
discretization step for which a large number of options are available.
We have used Finite Element Method as one of the options.

\subsubsection{Matrix-Newton Solver}
After discretizing the D2N operators the problem on the interfaces
reduces to a matrix problem of size $4p+2$. The matrix entries depend
nonlinearly on the Floquet multiplier $\gamma$ and the problem is to 
find $\gamma$ such that $T(\gamma)$ is singular.


The fundamental transverse mode must satisfy the periodic condition

\begin{equation}
u(x,z + \Lambda) = e^{\gamma \Lambda} u(x,z),
\end{equation}

where the propagation constant $\gamma$ is (in general)
complex. Because of this condition, it suffices to solve the Helmholtz
equation in one fundamental period $\Lambda$ of the grating. The
boundary conditions on the upper and the lower boundary of the period,
$\Gamma_2$ and $\Gamma_0$, repectively are

\begin{equation}
u|_{\Gamma_2} = e^{\gamma \Lambda} u|_{\Gamma_0} \textrm{and}
\frac{\partial u}{\partial n} |_{\Gamma_2} = -e^{\gamma \Lambda}
 \frac{\partial u}{\partial n} |_{\Gamma_0}
\end{equation}

The negative sign in the above equation is due to the normals at
$\Gamma_2$ and $\Gamma_0$ pointing in opposite directions.

In the numerical treatment of Helmholz equation, the transverse
structure is divided into three regions. The interior region
$\Omega_{int}$ contains the grating layer and two semi-infinite
exterior regions, $\Omega_+$ and $\Omega_-$ include the stratified
layers above and below the grating layer repectively (see
Fig. \ref{gratwg2}). The left interface of the domain is denoted by
$\Gamma_3^-$ and $\Gamma_3^+$ is the right interface.

\setlength{\unitlength}{0.25in}
\begin{picture}(20,10)(-2.5,0) \put(0,0){\line(1,0){15}}
\put(0,2.5){\line(1,0){15}} \put(0,5){\line(1,0){15}}
\put(5,-0.4){\line(0,1){5.8}} \put(7.5,-0.4){\line(0,1){5.8}}
\put(9.5,0){\line(0,1){1.0}} \put(9.5,2.5){\line(0,1){1.0}}
\put(10.5,2.5){\line(0,1){1.0}}
\label{gratwg2}
\end{picture}

The solution in the exterior regions is expanded in terms of space
harmonics in the form

\begin{equation}
u(x,z) = \sum_{n \in \mathbf{Z}} f_n^- e^{(ik_{xn}^J(x -
x^+))} e^{k_{zn}z}, x \geq x^+
\label{spharm1}
\end{equation}

\begin{equation}
u(x,z) = \sum_{n \in \mathbf{Z}} f_n^+ e^{(ik_{xn}^0(x^- -
x))} e^{k_{zn}z}, x \geq x^-
\label{spharm2}
\end{equation}

where $i = sqrt{-1}, j \in \lbrace 0,J \rbrace$ and

\begin{equation} k_{zn} = \frac{2 n \pi i}{\Lambda} + \gamma,
\end{equation}

\begin{equation} k_{xn}^j = \pm \sqrt{k_{zn}^2 + \mu_j \epsilon_j
\omega^2}
\end{equation}

The $f_n^\pm$ are the fourier coefficients of the solution on
$\Gamma_3^\pm$

\begin{equation}
f_n^\pm = \frac{1}{\Lambda}\int_0 u(x^\pm,z) e^{-k_{zn} z} dz
\label{fcoeff}
\end{equation}

The solution in the exterior regions can be obtained from
\ref{fcoeff}, \ref{spharm1}, \ref{spharm2}, if $\gamma$ and $u$ on the
interface $\Gamma_3$ are given. The mapping from $u|_{\Gamma_3}$ to
$\frac{\partial u}{\partial n} |_{\Gamma_3}$ is the
Dirichlet-to-Neumann (DtN) map for the exterior region, which we write
as

\begin{equation}
\frac{\partial u}{\partial n} |_{\Gamma_3} \coloneqq T_{ext}(\gamma)
u|_{\Gamma_3} = \left \{ \begin{array}{ll} \sum_{n \in \mathbf{Z}} i
k_{xn}^J f_n^+ e^{k_{zn}z} \quad \textrm{on} \; \Gamma_3^+ \\
\sum_{n \in \mathbf{Z}} ik_{xn}^0 f_n^- e^{-k_{zn}z} \quad
\textrm{on}\; \Gamma_3^- \end{array}\right .
\end{equation}

The problem is reduced to finding the values of $\gamma$ for which the
Helmholtz equation in $\Omega_{int}$ has non-trivial solutions.

\begin{equation}
\begin{array}{ll}
\triangle u + \mu \epsilon \omega^2 u = 0, \quad \textrm{in}
\Omega_{int} \\
u|_{\Gamma_2} = e^{\gamma \Lambda} u|_{\Gamma_0} \\
\frac{\partial u}{\partial n} |_{\Gamma_2} = -e^{\gamma \Lambda}
 \frac{\partial u}{\partial n} |_{\Gamma_0} \\
\frac{\partial u}{\partial n} |_{\Gamma_3} =  T_{ext}(\gamma) u|_{\Gamma_3}
\end{array}
\end{equation} 

 The eigen value problem is then solved in the interior region
numerically using the Boundary Element Method and matched with the
analytical solution in the exterior regions.

Helmholtz equation is reduced to a linear system after
discretization. Some coefficients of this linear system depend on the
propagation constant $\gamma$ non-linearly. The task is to find
$\gamma$ such that the matrix is non-singular, which is a non-linear
eigen value problem.

Previous methods differ in the solution of the interior problem; for
instance \ref{} describes expansion in spatial harmonics, and \ref{}
describes use of boundary element method.

The approach followed here is an equivalent formulation based on DtN
map which leads to much smaller matrix problems. The Helmholtz
equation in $\Omega_{int}$ with given Dirichlet boundary conditions on
$\Gamma_3$

\begin{equation}
\begin{array}{ll}
\triangle u + \mu \epsilon \omega^2 u = 0, \quad \textrm{in}
\Omega_{int} \\
u|_{\Gamma_2} = e^{\gamma \Lambda} u|_{\Gamma_0} \\
\frac{\partial u}{\partial n} |_{\Gamma_2} = -e^{\gamma \Lambda}
 \frac{\partial u}{\partial n} |_{\Gamma_0} \\
u|_{\Gamma_3} = f
\end{array}
\label{DtNf}
\end{equation} 

has a unique solution $u$.

The interior DtN map is given by
\begin{equation}
  T_{int}(\gamma) f = \frac{\partial u}{\partial n} |_{\Gamma_3}
\end{equation} 

where $u$ is the solution of \ref{DtNf}.

The propagation constants are values of $\gamma$ that make the operator
\begin{equation}
T(\gamma) = T_{int}(\gamma) - T_{ext}(\gamma)
\label{eqTdiff}
\end{equation} 

singular. That is, there is a Dirichlet condition f $\neq$ 0 on
$\Gamma_3$ such that
\begin{equation}
T(\gamma) f = 0
\label{eqTf}
\end{equation}

Since f is in the nullspace of $T(\gamma)$, the normal derivatives
approached from both sides of the interface match, and therefore $u$
is a solution on the infinite strip and $\gamma$ is a propagation
constant.

Problem \ref{eqTf} is attractive for numerical calculation because the
unknown f is defined only on the interface $\Gamma_3$. Thus fewer
degrees of freedom in the discretization are required than the problem
in $\Omega_{int}$.

\subsubsection{Discretization of the DtN map}
To discretize operator equation \ref{eqTf} a Galerkin approach is
employed. To this end, the approximate solution is written as a linear
combination of harmonics up to a given degree $p$.
\begin{equation}
f_p = \sum_{|n|\leq p} f_n^+ e_n^+ + \sum_{|n| \leq p} f_n^- e_n^-
\label{eqfp}
\end{equation} 

where

\begin{equation}
e_n^\pm (z)\coloneqq \left \{ \begin{array} {ll}
e^{k_{zn} z}, \quad \textrm{on} \; \Gamma_3^{\pm}, \\
0, \quad \textrm{on} \; \Gamma_3^\pm,
\end{array} \right .
\label{eqepm}
\end{equation} 

We seek a propagation-constant $\gamma_p$ and a non-zero function $f_p$ of
the form of \ref{eqfp} such that the residual $T(\gamma_p) f_p$ is
orthogonal to the functions $e_n^\pm$ for $|n| \leq p$. This
results in the non-linear eigenvalue problem

\begin{equation}
T(\gamma_p) f_p = 0,
\label{eqTpfp}
\end{equation} 

where $T(\gamma_p)$ is a matrix of size $4p+2$ whose coefficients depend nonlinearly on $\gamma$.

The coefficients of $T(\gamma_p)$ are the discretized interior and
exterior DtN maps difference \ref{eqTdiff}. It follows from \ref{} and
the orthognality of the harmonics that the exterior discretized DtN
map is a diagonal matrix of size $4p+2$ with entries $ik_{xn}^0$ and
$ik_{xn}^J$.

In the interior region coupling of modes occurs and thus the
discretization of the interior DtN map is a dense matrix. The interior
problems \ref{DtNf} with the Dirichlet condition

\begin{equation}
  f = e_n^\pm
\label{fe}
\end{equation} 

on $\Gamma_\pm$ must be solved $4p+2$ times for all harmonics in
\ref{eqepm} to obtain the colums of the matrix. The matrix entries of
$T_{int,p}(\gamma)$ are the Fourier coefficients of the normal
derivative of the solutions of \ref{DtNf} with the boundary conditions of
$\Gamma_3$ given by \ref{fe}, that is,

\begin{equation}
[T_{int,p}(\gamma)]_{n \pm,m \pm} = \int_0^\Lambda e_n^\pm(z)
\frac{\partial \bar{u}_m}{\partial n_z} \bigg|_{\Gamma_3^\pm} dz
\label{TintCoeff}
\end{equation}

The interior problem \ref{DtNf} has no closed solution and therefore a
second discretization is required to obtain the normal derivatives of
the field in \ref{TintCoeff}. This can be accomplished with a finite
element discretization as demonstrated in \ref{}, and more recently
with a more efficient BEM \ref{}.

Since the BEM has only unknowns on the interfaces $\Gamma_0$,
$\Gamma_1$, $\Gamma_2$ and $\Gamma_3$, the resulting influence matrix
is small enough to be handled with direct methods as opposed to
iterative methods which are more expensive for small problems. The
influence matrix and its LU decomposition have to be computed only
once to solve the $4p+2$ interior problems. Thus the overall
computational cost does not significantly increase with $p$.

Once the solution of \ref{eqTpfp} has been determined, the eigenmode can be
calculated in the exterior regions by \ref{spharm1} and in the interior
regions by using the Green's formula.

\subsection{Exterior Problem}
It is important for the efficiency of the method that the interior
domain $\Omega_{int}$ is kept as small as possible, since the interior
problem must be solved repeatedly for each step of the non-linear
solver. This can be achieved by including the uniform layers in the
exterior domains $\Omega_+$ and $\Omega_-$. To account for these
layers, the exterior DtN map must be modified using a transfer matrix
analysis.

For a TE mode, the j-th finite stratified layer is of the form
\begin{equation}
u(x,z) = \sum_{n \in \mathbf{Z}} e^{k_{zn} z} \{cos(k_{xn}^j(x-x_j))
\phi_n^j + \frac{u_j}{k_{xn}^j} sin(k_{xn}^j(x-x_j))\psi_n^j \}
\end{equation}

The state variables $\phi_n^j$ and $\psi_n^j$ describe the function
value and the derivative at the interfaces of the layers and are given
by
\begin{equation}
\phi_n^j = u_n(x_j),
\end{equation}

\begin{equation}
\psi_n^j = \frac{1}{u_j} \frac{\partial{u_n}}{\partial{x}},
\end{equation}

where the $u_n$'s are the Fourier coefficients of $u$. The interface
condition on $u$ in \ref{}, results in the state variables of two
adjacent layers coupled via the relation

\begin{equation}
\left[ \begin{array}{ll} \phi_n^{j+1} \\ \psi_n^{j+1}
\end{array} \right] = T_n^j(\gamma)
\begin{array}{ll} [\phi_n^{j} \\ \psi_n^{j}] \end{array}
\end{equation}

where the matrix $T_n^j(\gamma)$ is the transfer matrix of the state
variables across layer j

\begin{equation}
T_n^j(\gamma) = \left[ \begin{array}{cc} 1 & 0 \\
0 & \frac{1}{u_j} \end{array} \right]
\left[ \begin{array}{cc}  cos(k_{xn}^j w_j) & sin(k_{xn}^j
 w_j)/k_{xn}^j \\
-sin(k_{xn}^j w_j) k_{xn}^j & cos(k_{xn}^j w_j) \end{array}
\right]\left[ \begin{array}{cc} 1 & 0 \\
0 & u_j \end{array} \right]
\end{equation}

and $w_j$ is the width of the $j^{th}$ layer.

The translation of the state variables from the outer- to the
innermost layer (i.e the interface $\Gamma_3^-$ located at $x_j-$) is
the product of translation operators across all layers

\begin{equation}
\left[ \begin{array}{ll} \phi_k^{j^-} \\ \psi_k^{j^-}
\end{array} \right] = T_n^{j^-}(\gamma) ..... T_n^1(\gamma)
\begin{array}{ll} [1 \\ k_{xn}^0] \end{array}
\end{equation}
w\begin{equation}
\left[ \begin{array}{ll} \phi_n^{j+1} \\ \psi_n^{j+1}
\end{array} \right] = T_n^j(\gamma)
\begin{array}{ll} [\phi_n^{j} \\ \psi_n^{j}] \end{array}
\end{equation}

The translation to the interface $\Gamma_3^+$ located at $x_j+$
follows in a similar fashion. The DtN maps at $\Gamma_3$ are then
given by 

\begin{equation}
T_{ext}(\gamma) e_n^\pm = u_j \frac{\psi_n^{j^\pm}}{\phi_n^{j^\pm}} e_n^\pm
\end{equation}

The exterior DtN map for the TM mode can be obtained by replacing the
$u$'s in the formulas (\ref{}-\ref{}) by $\epsilon$'s.

\subsection{Nonlinear Solver}
A modification of the Newton's method for the solution of the
nonlinear eigenvalue problem \ref{} is explained in this section. An
approach is to find the roots of the determinant of $T_p(\gamma)$ or
to find the roots of the function

\begin{equation}
F(x,\gamma) = \left[ \begin{array}{cc} T_p(\gamma)x \\
x*x-1 \end{array} \right]
\end{equation}

with either Newton's or Muller's method. Although both ideas have been
considered, see, e.g., \ref{} and the references therein, they have
difficulties for the application considered. The determinant has large
variation in $\gamma$ which can cause an iterative solver to converge
to a non-physical root. A solver based on setting $F(x,\gamma)$ = 0
requires in addition to the propagation constant a good initial guess
for the eigenvector $x$; this is hard near Bragg condition where
solution branches intersect or nearly intersect. In this case, both
solution techniques will converge only in a small neighborhood of the
root.

The nonlinear solver (Matrix Newton Method) used in this project has
unique advantages associated with its convergence. The idea is to
determine the correction of the current approximation $\bar{\gamma}$
(where $T _p$ is nonsingular) such that the linearization of
$T_p(\bar{\gamma}+\delta)$ becomes singular. The Newton correction can
be determined from the largest eigenvalue $\lambda$ of
$T_p(\bar{\gamma})^{-1} T_p^\prime (\bar{\gamma})$ by Linearizing about
$\bar{\gamma}$.

\begin{equation}
T_p(\bar{\gamma})+\delta T_p^\prime (\bar{\gamma}) = \delta T_p(\bar{\gamma})
(\frac{1}{\delta} I + T_p(\bar{\gamma})^{-1} T_p^\prime (\bar{\gamma}))
\end{equation}

The next iterate is then given by
$\bar{\gamma} \coloneqq \bar{\gamma}-\frac{1}{\lambda}$. Since discretizations typically
require only a small value of $p$, the additional numerical cost for
solving the eigenvalue problem for each linearization is insignificant
compared to the cost of setting up the matrix $T_p(\gamma)$.

\subsection{Branch Choice of Complex Square Root}
The sign of the square root in the transverse wave number of the
semi-infinite layers is a critical issue, because its choice
determines whether the $n^{th}$ harmonic will be proper or improper.
For a planar guide without any corrugation all modes either move away
or decay from the guiding region. Since for a planar guide the
propagation constant is purely imaginary, it follows that the positive
branch in \ref{} must be chosen.

